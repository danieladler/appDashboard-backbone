<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>appDash - backbone</title>
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-2.2.4.js"></script>
    <script src="./js/lib/underscore.js"></script>
    <script src="./js/lib/backbone.js"></script>
    <div id="app-container"></div>
  </body>
</html>

<script type="text/template" id="app-template">
  <h2> <%= name %> </h2>
</script>

<script>
  // Models
  var AppType = Backbone.Model.extend({
    defaults: {
      name: "",
      url: "",
      type: "",
    },
    // listeners are in initalize
    initialize: function(){
      console.log(this.attributes.name, "has been initialized");
      this.on('invalid', function(model, error){
        console.log(error);
      });
    },
    // validations
    validate: function(attrs,opts){
      if(attrs.name === "" || attrs.url === ""){
        return "This field cannot be blank"
      }
    }
  });

  // Collections
  var AppColl = Backbone.Collection.extend({
    url : '/apps',
    model: AppType
  });

  // Views
    // individual app item view
  var AppView = Backbone.View.extend({
      className: "app-div",

      template: _.template($("#app-template").html()),

      events: {
        // TODO: add event listeners for interactions with individual apps
        // click on div
        // populate <input />
        // select from dropdown

        //NB: add functions below for these events as well!
      },

      // TODO: comment this initialize back in when working on events
      // initialize: function() {
      //   this.listenTo(this.model, 'change', this.render);
      // },

      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        return this;
      },
  });

  // collectionView for all apps
  var DashView = Backbone.View.extend({
    render: function(){
      var appList = this.collection.models;
      _.each(appList, function(app) {
        var appView = new AppView({model: app});
        this.$el.append(appView.render().el);
      }, this);
    },
  });

  // instantiate the apps
  var jira = new AppType({name: "Jira", url: "http://modusoperandi.atlassian.net/secure/Dashboard.jspa"});
  var conf = new AppType({name: "Confluence", url: "https://modusoperandi.atlassian.net/wiki/"});
  var hip  = new AppType({name: "HipChat", url: "https://modop.hipchat.com/home"});

  // instantiate the collection of apps
  var appTypes = new AppColl([jira, conf, hip]);

  // instantiate the collectionView for the whole dash
  var dashView = new DashView({el: "#app-container", collection: appTypes})
  dashView.render();


</script>
